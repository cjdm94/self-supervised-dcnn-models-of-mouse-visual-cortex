<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>3 clusters (20 pts each) with unique hover images</title>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #plot { width: 100%; height: 100%; }
    #hover-image {
      position: absolute;
      top: 75%;
      left: 50%;
      transform: translate(-50%, -50%); /* Center the image */
      max-width: 150px;
      max-height: 150px;
      border: 2px solid #333;
      border-radius: 5px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
<div id="plot"></div>
<img id="hover-image" src="" alt="Cluster Image" />

<script>
const RANGE = [0, 10];

// ---------- seeded RNG + gaussian ----------
function mulberry32(seed){
  return function(){
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
const rand = mulberry32(123456);
function randn(){ // Boxâ€“Muller using seeded uniform
  let u = 0, v = 0;
  while (u === 0) u = rand();
  while (v === 0) v = rand();
  return Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
}
const clamp = (x,a,b) => Math.max(a, Math.min(b, x));

// ---------- layout ----------
const layout = {
  scene: {
    xaxis: { range: RANGE, showgrid: false, showticklabels: true, ticks: "outside", tick0:0, dtick:2, tickfont:{size:10}, color:"#333", showspikes: false },
    yaxis: { range: RANGE, showgrid: false, showticklabels: true, ticks: "outside", tick0:0, dtick:2, tickfont:{size:10}, color:"#333", showspikes: false },
    zaxis: { range: RANGE, showgrid: false, showticklabels: true, ticks: "outside", tick0:0, dtick:2, tickfont:{size:10}, color:"#333", showspikes: false },
    aspectmode: "cube",
  },
  margin: { l:0, r:0, t:0, b:0 },
  showlegend: true,
};
const config = { responsive: true, displaylogo: false, scrollZoom: true };

// ---------- helpers to draw axes + grids ----------
function axesLines(color="#222") {
  const [a,b]=RANGE;
  return {
    type: "scatter3d", mode: "lines",
    x: [a,b,null, a,a,null, a,a],
    y: [a,a,null, a,b,null, a,a],
    z: [a,a,null, a,a,null, a,b],
    line: { width: 4, color },
    showlegend: false
  };
}
function labelTrace(text, x, y, z) {
  return { type:"scatter3d", mode:"text", x:[x], y:[y], z:[z], text:[text],
           textfont:{ size:20, color:"#222" }, hoverinfo:"skip", showlegend:false };
}
function gridPlaneXY(step=2, z=RANGE[0], color="rgba(0,0,0,.25)") {
  const [a,b]=RANGE; const xs=[], ys=[], zs=[];
  for (let x=a+step; x<=b-step; x+=step) { xs.push(x,x,null); ys.push(a,b,null); zs.push(z,z,null); }
  for (let y=a+step; y<=b-step; y+=step) { xs.push(a,b,null); ys.push(y,y,null); zs.push(z,z,null); }
  return { type:"scatter3d", mode:"lines", x:xs, y:ys, z:zs, line:{width:1,color}, opacity:0.9, hoverinfo:"skip", showlegend:false };
}
function gridPlaneYZ(step=2, x=RANGE[0], color="rgba(0,0,0,.15)") {
  const [a,b]=RANGE; const xs=[], ys=[], zs=[];
  for (let y=a+step; y<=b-step; y+=step) { xs.push(x,x,null); ys.push(y,y,null); zs.push(a,b,null); }
  for (let z=a+step; z<=b-step; z+=step) { xs.push(x,x,null); ys.push(a,b,null); zs.push(z,z,null); }
  return { type:"scatter3d", mode:"lines", x:xs, y:ys, z:zs, line:{width:1,color}, opacity:0.9, hoverinfo:"skip", showlegend:false };
}
function gridPlaneZX(step=2, y=RANGE[0], color="rgba(0,0,0,.15)") {
  const [a,b]=RANGE; const xs=[], ys=[], zs=[];
  for (let z=a+step; z<=b-step; z+=step) { xs.push(a,b,null); ys.push(y,y,null); zs.push(z,z,null); }
  for (let x=a+step; x<=b-step; x+=step) { xs.push(x,x,null); ys.push(y,y,null); zs.push(a,b,null); }
  return { type:"scatter3d", mode:"lines", x:xs, y:ys, z:zs, line:{width:1,color}, opacity:0.9, hoverinfo:"skip", showlegend:false };
}

// ---------- cluster generation ----------
function makeCluster(center, n=20, sigma=0.6){
  const x=[], y=[], z=[];
  for (let i=0; i<n; i++){
    x.push(clamp(center[0] + randn()*sigma, RANGE[0], RANGE[1]));
    y.push(clamp(center[1] + randn()*sigma, RANGE[0], RANGE[1]));
    z.push(clamp(center[2] + randn()*sigma, RANGE[0], RANGE[1]));
  }
  return { x, y, z };
}
function clusterTrace(cluster, name, color, className){
  // Generate unique image paths for each point (00 to 19)
  const images = Array.from({length: cluster.x.length}, (_, i) => 
    `stimuli_20/${className}_${i.toString().padStart(2, '0')}.png`
  );
  return {
    type: "scatter3d",
    mode: "markers",
    name,
    x: cluster.x, y: cluster.y, z: cluster.z,
    marker: { size: 5, color },
    customdata: images, // Assign unique image to each point
    hoverinfo: "none", // No default hover label
    hovertemplate: null // Ensure no template box
  };
}

// pick well-separated centers and assign classes
const centers = [
  { name: "Birds", center: [2, 2, 2], color: "#0072B2", class: "bird" },
  { name: "Snakes", center: [8, 8, 8], color: "#E69F00", class: "snake" },
  { name: "Fungi", center: [2, 8, 5], color: "#009E73", class: "fungi" },
];
const sigma = 0.6; // spread of each cluster

(async function main(){
  const gd = await Plotly.newPlot("plot", [], layout, config);

  // axes + labels + grid
  await Plotly.addTraces(gd, [axesLines()]);
  const [a,b] = RANGE;
  await Plotly.addTraces(gd, [
    labelTrace("neuron 1", a, b, a),
    labelTrace("neuron 2", a, a, b),
    labelTrace("neuron n", b, a, a),
    gridPlaneXY(2, RANGE[0]),
    gridPlaneYZ(2, RANGE[0]),
    gridPlaneZX(2, RANGE[0]),
  ]);

  // build and add the three clusters
  for (const c of centers){
    const cl = makeCluster(c.center, 20, sigma);
    const trace = clusterTrace(cl, c.name, c.color, c.class);
    await Plotly.addTraces(gd, [trace]);
  }

  // Get the image element
  const hoverImage = document.getElementById('hover-image');

  // Hover event to show image
  gd.on('plotly_hover', function(data) {
    const point = data.points[0];
    const imageUrl = point.customdata; // Get image path from customdata
    if (imageUrl) {
      hoverImage.src = imageUrl;
      hoverImage.style.display = 'block';
    }
  });

  // Unhover event to hide image
  gd.on('plotly_unhover', function() {
    hoverImage.style.display = 'none';
  });
})();
</script>
</body>
</html>